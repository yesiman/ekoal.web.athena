!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/operators"),require("tslib"),require("rxjs")):"function"==typeof define&&define.amd?define("@ngxs/store",["exports","@angular/core","rxjs/operators","tslib","rxjs"],e):e((t.ngxs=t.ngxs||{},t.ngxs.store={}),t.ng.core,t.Rx.Observable.prototype,t.tslib,t.rxjs)}(this,function(t,e,b,m,O){"use strict";var r=new e.InjectionToken("ROOT_STATE_TOKEN"),n=new e.InjectionToken("FEATURE_STATE_TOKEN"),w="NGXS_META",o=new e.InjectionToken("NGXS_PLUGINS"),a=function(){};function h(t){if(!t.hasOwnProperty(w)){Object.defineProperty(t,w,{value:{name:null,actions:{},defaults:{},path:null,children:[],instance:null}})}return t[w]}function i(t){for(var e=t,r="store."+e[0],n=0,o=e.length,a=r;++n<o;)a=a+" && "+(r=r+"."+e[n]);return new Function("store","return "+a+";")}function x(t){return t.constructor&&t.constructor.type?t.constructor.type:t.type}var c=function(t,e,r){t=Object.assign({},t);var n=e.split("."),o=n[n.length-1];return n.reduce(function(t,e){return t[e]=e===o?r:Object.assign({},t[e]),t&&t[e]},t),t},p=function(t,e){return e.split(".").reduce(function(t,e){return t&&t[e]},t)};function j(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return u(t,"DISPATCHED")}function u(t,e){var r=t.reduce(function(t,e){return t[x(e)]=!0,t},{});return function(t){return t.pipe((n=r,o=e,b.filter(function(t){var e=x(t.action),r=n[e];return o?r&&t.status===o:r})),b.map(function(t){return t.action}));var n,o}}var s=function(r){function t(){var t=r.apply(this,m.__spread(arguments))||this;return t._itemQueue=[],t._busyPushingNext=!1,t}return m.__extends(t,r),t.prototype.next=function(t){if(this._busyPushingNext)this._itemQueue.unshift(t);else{for(this._busyPushingNext=!0,r.prototype.next.call(this,t);0<this._itemQueue.length;){var e=this._itemQueue.pop();r.prototype.next.call(this,e)}this._busyPushingNext=!1}},t}(O.Subject),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m.__extends(e,t),e}(s);f.decorators=[{type:e.Injectable}];var l=function(e){function t(t){return e.call(this,function(e){t.subscribe(function(t){return e.next(t)},function(t){return e.error(t)},function(){return e.complete()})})||this}return m.__extends(t,e),t}(O.Observable);l.decorators=[{type:e.Injectable}],l.ctorParameters=function(){return[{type:f}]};var d=function(r){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.shift().apply(void 0,m.__spread(t,[function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d(r).apply(void 0,m.__spread(t))}]))}},y=function(t){function e(){return t.call(this,{})||this}return m.__extends(e,t),e}(O.BehaviorSubject);y.decorators=[{type:e.Injectable}],y.ctorParameters=function(){return[]};var v=function(){function t(t,e){this._parentManager=t,this._plugins=e,this.plugins=[],this.register()}return t.prototype.register=function(){var t;this._plugins&&(this.plugins=this._plugins.map(function(t){return t.handle?t.handle.bind(t):t}),this._parentManager&&(t=this._parentManager.plugins).push.apply(t,m.__spread(this.plugins)))},t}();function g(r){return function(t){return new O.Observable(function(e){return t.subscribe({next:function(t){r.run(function(){return e.next(t)})},error:function(t){r.run(function(){return e.error(t)})},complete:function(){r.run(function(){return e.complete()})}})})}}v.decorators=[{type:e.Injectable}],v.ctorParameters=function(){return[{type:v,decorators:[{type:e.Optional},{type:e.SkipSelf}]},{type:Array,decorators:[{type:e.Inject,args:[o]},{type:e.Optional}]}]};var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m.__extends(e,t),e}(O.Subject);_.decorators=[{type:e.Injectable}];var S=function(){function t(t,e,r,n,o,a){this._errorHandler=t,this._actions=e,this._actionResults=r,this._pluginManager=n,this._stateStream=o,this._ngZone=a}return t.prototype.dispatch=function(t){var e=this,r=this._ngZone.runOutsideAngular(function(){return Array.isArray(t)?O.forkJoin(t.map(function(t){return e.dispatchSingle(t)})):e.dispatchSingle(t)});return r.subscribe({error:function(t){return e._ngZone.run(function(){return e._errorHandler.handleError(t)})}}),r.pipe(g(this._ngZone))},t.prototype.dispatchSingle=function(t){var n=this,o=this._stateStream.getValue(),e=this._pluginManager.plugins;return d(m.__spread(e,[function(t,e){t!==o&&n._stateStream.next(t);var r=n.getActionResultStream(e);return r.subscribe(function(t){return n._actions.next(t)}),n._actions.next({action:e,status:"DISPATCHED"}),n.createDispatchObservable(r)}]))(o,t).pipe(b.shareReplay())},t.prototype.getActionResultStream=function(e){return this._actionResults.pipe(b.filter(function(t){return t.action===e&&"DISPATCHED"!==t.status}),b.take(1),b.shareReplay())},t.prototype.createDispatchObservable=function(t){var e=this;return t.pipe(b.exhaustMap(function(t){switch(t.status){case"SUCCESSFUL":return O.of(e._stateStream.getValue());case"ERRORED":return O.throwError(t.error);default:return O.empty()}})).pipe(b.shareReplay())},t}();S.decorators=[{type:e.Injectable}],S.ctorParameters=function(){return[{type:e.ErrorHandler},{type:f},{type:_},{type:v},{type:y},{type:e.NgZone}]};var A=function(e){Object.freeze(e);var r="function"==typeof e,n=Object.prototype.hasOwnProperty;return Object.getOwnPropertyNames(e).forEach(function(t){!n.call(e,t)||r&&("caller"===t||"callee"===t||"arguments"===t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||A(e[t])}),e},E=function(){function t(t,e,r){this._stateStream=t,this._dispatcher=e,this._config=r}return t.prototype.getRootStateOperations=function(){var e=this,t={getState:function(){return e._stateStream.getValue()},setState:function(t){return e._stateStream.next(t)},dispatch:function(t){return e._dispatcher.dispatch(t)}};return this._config.developmentMode?this.ensureStateAndActionsAreImmutable(t):t},t.prototype.ensureStateAndActionsAreImmutable=function(r){return{getState:function(){return r.getState()},setState:function(t){var e=A(t);return r.setState(e)},dispatch:function(t){return r.dispatch(t)}}},t}();E.decorators=[{type:e.Injectable}],E.ctorParameters=function(){return[{type:y},{type:S},{type:a}]};var P=function(){function t(t){this._internalStateOperations=t}return t.prototype.createStateContext=function(u){var s=this._internalStateOperations.getRootStateOperations();return{getState:function(){var t=s.getState();return p(t,u.depth)},patchState:function(t){var e="object"!=typeof t;if(Array.isArray(t))throw new Error("Patching arrays is not supported.");if(e)throw new Error("Patching primitives is not supported.");var r=s.getState(),n=p(r,u.depth),o=Object.assign({},n);for(var a in t)o[a]=t[a];var i=c(r,u.depth,o);return s.setState(i),i},setState:function(t){var e=s.getState();return e=c(e,u.depth,t),s.setState(e),e},dispatch:function(t){return s.dispatch(t)}}},t}();P.decorators=[{type:e.Injectable}],P.ctorParameters=function(){return[{type:E}]};var I=function(){function t(t,e,r,n,o){this._injector=t,this._parentFactory=e,this._actions=r,this._actionResults=n,this._stateContextFactory=o,this._states=[],this._connected=!1}return Object.defineProperty(t.prototype,"states",{get:function(){return this._parentFactory?this._parentFactory.states:this._states},enumerable:!0,configurable:!0}),t.prototype.add=function(t){var e;e=Array.isArray(t)?t:[t];var r,a,n,o,i,u,s,c,p,f=(a=function(e){var t=r.find(function(t){return t===e});if(!t)throw new Error("Child state not found: "+e);if(!t[w])throw new Error("States must be decorated with @State() decorator");return t[w].name},(r=e).reduce(function(t,e){if(!e[w])throw new Error("States must be decorated with @State() decorator");var r=e[w],n=r.name,o=r.children;return t[n]=(o||[]).map(a),t},{})),l=(n=f,o=[],i={},u=function(e,r){void 0===r&&(r=[]),Array.isArray(r)||(r=[]),r.push(e),i[e]=!0,n[e].forEach(function(t){if(0<=r.indexOf(t))throw new Error("Circular dependency '"+t+"' is required by '"+e+"': "+r.join(" -> "));i[t]||u(t,r.slice(0))}),o.indexOf(e)<0&&o.push(e)},Object.keys(n).forEach(function(t){return u(t)}),o.reverse()),h=function(t,e){void 0===e&&(e={});var o=function(t,e){for(var r in t)if(t.hasOwnProperty(r)&&0<=t[r].indexOf(e)){var n=o(t,r);return null!==n?n+"."+r:r}return null};for(var r in t)if(t.hasOwnProperty(r)){var n=o(t,r);e[r]=n?n+"."+r:r}return e}(f),d=e.reduce(function(t,e){if(!e[w])throw new Error("States must be decorated with @State() decorator");return t[e[w].name]=e,t},{}),y=[],v=function(e){var t=d[e];if(!t[w])throw new Error("States must be decorated with @State() decorator");var r,n=h[e],o=t[w].actions,a=t[w].defaults;if(t[w].path=n,!g.states.find(function(t){return t.name===e})){Array.isArray(a)?a=m.__spread(a):"object"==typeof(r=a)&&null!==r||"function"==typeof r?a=Object.assign({},a):a===undefined&&(a={});var i=g._injector.get(t);y.push({actions:o,instance:i,defaults:a,name:e,depth:n})}},g=this;try{for(var _=m.__values(l),S=_.next();!S.done;S=_.next()){v(S.value)}}catch(b){s={error:b}}finally{try{S&&!S.done&&(c=_["return"])&&c.call(_)}finally{if(s)throw s.error}}return(p=this.states).push.apply(p,m.__spread(y)),y},t.prototype.addAndReturnDefaults=function(t){if(t){var e=this.add(t);return{defaults:e.reduce(function(t,e){return c(t,e.depth,e.defaults)},{}),states:e}}},t.prototype.connectActionHandlers=function(){var r=this;this._connected||(this._actions.pipe(b.filter(function(t){return"DISPATCHED"===t.status}),b.mergeMap(function(t){var e=t.action;return r.invokeActions(r._actions,e).pipe(b.map(function(){return{action:e,status:"SUCCESSFUL"}}),b.defaultIfEmpty({action:e,status:"CANCELED"}),b.catchError(function(t){return O.of({action:e,status:"ERRORED",error:t})}))})).subscribe(function(t){return r._actionResults.next(t)}),this._connected=!0)},t.prototype.invokeInit=function(t){try{for(var e=m.__values(t),r=e.next();!r.done;r=e.next()){var n=r.value,o=n.instance;if(o.ngxsOnInit){var a=this.createStateContext(n);o.ngxsOnInit(a)}}}catch(s){i={error:s}}finally{try{r&&!r.done&&(u=e["return"])&&u.call(e)}finally{if(i)throw i.error}}var i,u},t.prototype.invokeActions=function(t,e){var r,n,o,a,i=[];try{for(var u=m.__values(this.states),s=u.next();!s.done;s=u.next()){var c=s.value,p=x(e),f=c.actions[p];if(f)try{for(var l=m.__values(f),h=l.next();!h.done;h=l.next()){var d=h.value,y=this.createStateContext(c);try{var v=c.instance[d.fn](y,e);v instanceof Promise&&(v=O.from(v)),v=v instanceof O.Observable?v.pipe(d.options.cancelUncompleted?b.takeUntil(t.pipe(j(e))):b.map(function(t){return t})):O.of({}).pipe(b.shareReplay()),i.push(v)}catch(g){i.push(O.throwError(g))}}}catch(_){o={error:_}}finally{try{h&&!h.done&&(a=l["return"])&&a.call(l)}finally{if(o)throw o.error}}}}catch(S){r={error:S}}finally{try{s&&!s.done&&(n=u["return"])&&n.call(u)}finally{if(r)throw r.error}}return i.length||i.push(O.of({})),O.forkJoin(i)},t.prototype.createStateContext=function(t){return this._stateContextFactory.createStateContext(t)},t}();function R(t){var e=t[w];if(e){var r=e.selectFromAppState;if(r)return r;if(e.path)return i(e.path.split("."))}return t}I.decorators=[{type:e.Injectable}],I.ctorParameters=function(){return[{type:e.Injector},{type:I,decorators:[{type:e.Optional},{type:e.SkipSelf}]},{type:f},{type:_},{type:P}]};var T=function(){function t(t,e,r){this._ngZone=t,this._stateStream=e,this._internalStateOperations=r}return t.prototype.dispatch=function(t){return this._internalStateOperations.getRootStateOperations().dispatch(t)},t.prototype.select=function(t){var e=R(t);return this._stateStream.pipe(b.map(e),b.catchError(function(t){if(t instanceof TypeError)return O.of(undefined);throw t}),b.distinctUntilChanged(),g(this._ngZone))},t.prototype.selectOnce=function(t){return this.select(t).pipe(b.take(1))},t.prototype.selectSnapshot=function(t){return R(t)(this._stateStream.getValue())},t.prototype.subscribe=function(t){return this._stateStream.pipe(g(this._ngZone)).subscribe(t)},t.prototype.snapshot=function(){return this._internalStateOperations.getRootStateOperations().getState()},t.prototype.reset=function(t){return this._internalStateOperations.getRootStateOperations().setState(t)},t}();T.decorators=[{type:e.Injectable}],T.ctorParameters=function(){return[{type:e.NgZone},{type:y},{type:E}]};var C=function(t){};C.store=undefined,C.decorators=[{type:e.Injectable}],C.ctorParameters=function(){return[{type:T}]};var D=function(){};D.type="@@INIT";var F=function(){};F.type="@@UPDATE_STATE";var N=function(t,e,r,n,o){var a=t.addAndReturnDefaults(o),i=e.getRootStateOperations();if(a){var u=i.getState();i.setState(Object.assign({},u,a.defaults))}t.connectActionHandlers(),i.dispatch(new D).subscribe(function(){a&&t.invokeInit(a.states)})};N.decorators=[{type:e.NgModule}],N.ctorParameters=function(){return[{type:I},{type:E},{type:T},{type:C},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[r]}]}]};var k=function(t,e,r,n){var o=[].concat.apply([],m.__spread(n)),a=r.addAndReturnDefaults(o),i=e.getRootStateOperations();if(a){var u=i.getState();i.setState(Object.assign({},u,a.defaults))}i.dispatch(new F).subscribe(function(){a&&r.invokeInit(a.states)})};function M(t){return Object.assign(new a,t)}k.decorators=[{type:e.NgModule,args:[{}]}],k.ctorParameters=function(){return[{type:T},{type:E},{type:I},{type:Array,decorators:[{type:e.Optional},{type:e.Inject,args:[n]}]}]};var U=new e.InjectionToken("ROOT_OPTIONS"),Z=function(){function t(){}return t.forRoot=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e={}),{ngModule:N,providers:m.__spread([I,P,l,f,S,_,E,T,y,C,v],t,[{provide:r,useValue:t},{provide:U,useValue:e},{provide:a,useFactory:M,deps:[U]}])}},t.forFeature=function(t){return{ngModule:k,providers:m.__spread([I,v],t,[{provide:n,multi:!0,useValue:t}])}},t}();Z.decorators=[{type:e.NgModule,args:[{}]}];var H=new RegExp("^[a-zA-Z0-9]+$"),V=function(t){return t+" is not a valid state name. It needs to be a valid object property name."};function L(t,e){return t===e}function q(t,e){void 0===e&&(e=L);var r=null,n=null;return function(){return function(t,e,r){if(null===e||null===r||e.length!==r.length)return!1;for(var n=e.length,o=0;o<n;o++)if(!t(e[o],r[o]))return!1;return!0}(e,r,arguments)||(n=t.apply(null,arguments)),r=arguments,n}}t.ɵg=f,t.ɵf=s,t.ɵl=_,t.ɵm=S,t.ɵb=k,t.ɵa=N,t.ɵd=U,t.ɵc=M,t.ɵp=v,t.ɵe=C,t.ɵn=P,t.ɵk=I,t.ɵo=E,t.ɵi=n,t.ɵj=a,t.ɵh=r,t.NgxsModule=Z,t.Action=function(f,l){return function(t,e,r){var n,o,a=h(t.constructor);Array.isArray(f)||(f=[f]);try{for(var i=m.__values(f),u=i.next();!u.done;u=i.next()){var s=u.value,c=s.type;if(!s.type)throw new Error("Action "+s.name+' is missing a static "type" property');a.actions[c]||(a.actions[c]=[]),a.actions[c].push({fn:e,options:l||{},type:c})}}catch(p){n={error:p}}finally{try{u&&!u.done&&(o=i["return"])&&o.call(i)}finally{if(n)throw n.error}}}},t.Store=T,t.State=function(n){return function(t){var e=h(t);if(Object.getPrototypeOf(t).hasOwnProperty(w)){var r=Object.getPrototypeOf(t)[w];e.actions=Object.assign({},e.actions,r.actions)}if(e.children=n.children,e.defaults=n.defaults,e.name=n.name,!n.name)throw new Error("States must register a 'name' property");if(!H.test(n.name))throw new Error(V(n.name))}},t.Select=function(n){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];return function(t,e){var r="__"+e+"__selector";if(n||(n=e.lastIndexOf("$")===e.length-1?e.substring(0,e.length-1):e),t[r])throw new Error("You cannot use @Select decorator and a "+r+" property.");delete t[e]&&(Object.defineProperty(t,r,{writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(t,e,{get:function(){return this[r]||(this[r]=function(t){var e=C.store;if(!e)throw new Error("SelectFactory not connected to store!");return e.select(t)}.apply(this,["string"==typeof n?i(o.length?m.__spread([n],o):n.split(".")):n[w]&&n[w].path?i(n[w].path.split(".")):n]))},enumerable:!0,configurable:!0}))}},t.Actions=l,t.ofAction=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return u(t)},t.ofActionSuccessful=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return u(t,"SUCCESSFUL")},t.ofActionDispatched=j,t.ofActionErrored=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return u(t,"ERRORED")},t.Selector=function(s){return function(t,e,r){var n,o=h(t);if(null!==r.value){var a=r.value,i=q(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=a.apply(void 0,m.__spread(t));return r instanceof Function?q.apply(null,[r]):r}),u=((n=i).hasOwnProperty(w)||Object.defineProperty(n,w,{value:{selectFromAppState:null,originalFn:null,storeMetaData:null}}),n[w]);return u.originalFn=a,u.storeMetaData=o,u.selectFromAppState=function(e){var t=[];o&&o.path&&t.push(p(e,o.path)),s&&t.push.apply(t,m.__spread(s.map(function(t){return R(t)(e)})));try{return i.apply(void 0,m.__spread(t))}catch(r){if(r instanceof TypeError)return undefined;throw r}},{configurable:!0,get:function(){return i}}}throw new Error("Selectors only work on methods")}},t.getActionTypeFromInstance=x,t.actionMatcher=function(t){var e=x(t);return function(t){return e===x(t)}},t.NGXS_PLUGINS=o,t.StateStream=y,t.setValue=c,t.getValue=p,t.InitState=D,t.UpdateState=F,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngxs-store.umd.min.js.map
